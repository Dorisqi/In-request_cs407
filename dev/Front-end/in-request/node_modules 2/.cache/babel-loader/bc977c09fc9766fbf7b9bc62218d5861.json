{"ast":null,"code":"\"use strict\";\n/*!\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/*!\n * @module common/service-object\n */\n\nconst promisify_1 = require(\"@google-cloud/promisify\");\n\nconst arrify = require(\"arrify\");\n\nconst events_1 = require(\"events\");\n\nconst extend = require(\"extend\");\n\nconst util_1 = require(\"./util\");\n/**\n * ServiceObject is a base class, meant to be inherited from by a \"service\n * object,\" like a BigQuery dataset or Storage bucket.\n *\n * Most of the time, these objects share common functionality; they can be\n * created or deleted, and you can get or set their metadata.\n *\n * By inheriting from this class, a service object will be extended with these\n * shared behaviors. Note that any method can be overridden when the service\n * object requires specific behavior.\n */\n// tslint:disable-next-line no-any\n\n\nclass ServiceObject extends events_1.EventEmitter {\n  /*\n   * @constructor\n   * @alias module:common/service-object\n   *\n   * @private\n   *\n   * @param {object} config - Configuration object.\n   * @param {string} config.baseUrl - The base URL to make API requests to.\n   * @param {string} config.createMethod - The method which creates this object.\n   * @param {string=} config.id - The identifier of the object. For example, the\n   *     name of a Storage bucket or Pub/Sub topic.\n   * @param {object=} config.methods - A map of each method name that should be inherited.\n   * @param {object} config.methods[].reqOpts - Default request options for this\n   *     particular method. A common use case is when `setMetadata` requires a\n   *     `PUT` method to override the default `PATCH`.\n   * @param {object} config.parent - The parent service instance. For example, an\n   *     instance of Storage if the object is Bucket.\n   */\n  constructor(config) {\n    super();\n    this.metadata = {};\n    this.baseUrl = config.baseUrl;\n    this.parent = config.parent; // Parent class.\n\n    this.id = config.id; // Name or ID (e.g. dataset ID, bucket name, etc).\n\n    this.createMethod = config.createMethod;\n    this.methods = config.methods || {};\n    this.interceptors = [];\n    this.pollIntervalMs = config.pollIntervalMs;\n    this.Promise = this.parent ? this.parent.Promise : undefined;\n\n    if (config.methods) {\n      Object.getOwnPropertyNames(ServiceObject.prototype).filter(methodName => {\n        return (// All ServiceObjects need `request`.\n          // clang-format off\n          !/^request/.test(methodName) && // clang-format on\n          // The ServiceObject didn't redefine the method.\n          // tslint:disable-next-line no-any\n          this[methodName] === // tslint:disable-next-line no-any\n          ServiceObject.prototype[methodName] && // This method isn't wanted.\n          !config.methods[methodName]\n        );\n      }).forEach(methodName => {\n        // tslint:disable-next-line no-any\n        this[methodName] = undefined;\n      });\n    }\n  }\n\n  create(optionsOrCallback, callback) {\n    const self = this;\n    const args = [this.id];\n\n    if (typeof optionsOrCallback === 'function') {\n      callback = optionsOrCallback;\n    }\n\n    if (typeof optionsOrCallback === 'object') {\n      args.push(optionsOrCallback);\n    } // Wrap the callback to return *this* instance of the object, not the\n    // newly-created one.\n    // tslint: disable-next-line no-any\n\n\n    function onCreate(...args) {\n      const [err, instance] = args;\n\n      if (!err) {\n        self.metadata = instance.metadata;\n        args[1] = self; // replace the created `instance` with this one.\n      }\n\n      callback(...args);\n    }\n\n    args.push(onCreate);\n    this.createMethod.apply(null, args);\n  }\n\n  delete(optionsOrCallback, cb) {\n    const [options, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n    const methodConfig = typeof this.methods.delete === 'object' && this.methods.delete || {};\n    const reqOpts = extend(true, {\n      method: 'DELETE',\n      uri: ''\n    }, methodConfig.reqOpts, {\n      qs: options\n    }); // The `request` method may have been overridden to hold any special\n    // behavior. Ensure we call the original `request` method.\n\n    ServiceObject.prototype.request.call(this, reqOpts, callback);\n  }\n\n  exists(optionsOrCallback, cb) {\n    const [options, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n    this.get(options, err => {\n      if (err) {\n        if (err.code === 404) {\n          callback(null, false);\n        } else {\n          callback(err);\n        }\n\n        return;\n      }\n\n      callback(null, true);\n    });\n  }\n\n  get(optionsOrCallback, cb) {\n    const self = this;\n    const [opts, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n    const options = Object.assign({}, opts);\n    const autoCreate = options.autoCreate && typeof this.create === 'function';\n    delete options.autoCreate;\n\n    function onCreate(err, instance, apiResponse) {\n      if (err) {\n        if (err.code === 409) {\n          self.get(options, callback);\n          return;\n        }\n\n        callback(err, null, apiResponse);\n        return;\n      }\n\n      callback(null, instance, apiResponse);\n    }\n\n    this.getMetadata(options, (err, metadata) => {\n      if (err) {\n        if (err.code === 404 && autoCreate) {\n          const args = [];\n\n          if (Object.keys(options).length > 0) {\n            args.push(options);\n          }\n\n          args.push(onCreate);\n          self.create(...args);\n          return;\n        }\n\n        callback(err, null, metadata);\n        return;\n      }\n\n      callback(null, self, metadata);\n    });\n  }\n\n  getMetadata(optionsOrCallback, cb) {\n    const [options, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n    const methodConfig = typeof this.methods.getMetadata === 'object' && this.methods.getMetadata || {};\n    const reqOpts = extend(true, {\n      uri: ''\n    }, methodConfig.reqOpts, {\n      qs: options\n    }); // The `request` method may have been overridden to hold any special\n    // behavior. Ensure we call the original `request` method.\n\n    ServiceObject.prototype.request.call(this, reqOpts, (err, body, res) => {\n      this.metadata = body;\n      callback(err, this.metadata, res);\n    });\n  }\n\n  setMetadata(metadata, optionsOrCallback, cb) {\n    const [options, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n    const methodConfig = typeof this.methods.setMetadata === 'object' && this.methods.setMetadata || {};\n    const reqOpts = extend(true, {}, {\n      method: 'PATCH',\n      uri: ''\n    }, methodConfig.reqOpts, {\n      json: metadata,\n      qs: options\n    }); // The `request` method may have been overridden to hold any special\n    // behavior. Ensure we call the original `request` method.\n\n    ServiceObject.prototype.request.call(this, reqOpts, (err, body, res) => {\n      this.metadata = body;\n      callback(err, this.metadata, res);\n    });\n  }\n\n  request_(reqOpts, callback) {\n    reqOpts = extend(true, {}, reqOpts);\n    const isAbsoluteUrl = reqOpts.uri.indexOf('http') === 0;\n    const uriComponents = [this.baseUrl, this.id || '', reqOpts.uri];\n\n    if (isAbsoluteUrl) {\n      uriComponents.splice(0, uriComponents.indexOf(reqOpts.uri));\n    }\n\n    reqOpts.uri = uriComponents.filter(x => x.trim()) // Limit to non-empty strings.\n    .map(uriComponent => {\n      const trimSlashesRegex = /^\\/*|\\/*$/g;\n      return uriComponent.replace(trimSlashesRegex, '');\n    }).join('/');\n    const childInterceptors = arrify(reqOpts.interceptors_);\n    const localInterceptors = [].slice.call(this.interceptors);\n    reqOpts.interceptors_ = childInterceptors.concat(localInterceptors);\n\n    if (reqOpts.shouldReturnStream) {\n      return this.parent.requestStream(reqOpts);\n    }\n\n    this.parent.request(reqOpts, callback);\n  }\n\n  request(reqOpts, callback) {\n    this.request_(reqOpts, callback);\n  }\n  /**\n   * Make an authenticated API request.\n   *\n   * @param {object} reqOpts - Request options that are passed to `request`.\n   * @param {string} reqOpts.uri - A URI relative to the baseUrl.\n   */\n\n\n  requestStream(reqOpts) {\n    const opts = extend(true, reqOpts, {\n      shouldReturnStream: true\n    });\n    return this.request_(opts);\n  }\n\n}\n\nexports.ServiceObject = ServiceObject;\npromisify_1.promisifyAll(ServiceObject);","map":{"version":3,"sources":["/Users/qier/Documents/cs407/In-request_cs407/dev/Front-end/in-request/node_modules/@google-cloud/common/build/src/service-object.js"],"names":["Object","defineProperty","exports","value","promisify_1","require","arrify","events_1","extend","util_1","ServiceObject","EventEmitter","constructor","config","metadata","baseUrl","parent","id","createMethod","methods","interceptors","pollIntervalMs","Promise","undefined","getOwnPropertyNames","prototype","filter","methodName","test","forEach","create","optionsOrCallback","callback","self","args","push","onCreate","err","instance","apply","delete","cb","options","util","maybeOptionsOrCallback","methodConfig","reqOpts","method","uri","qs","request","call","exists","get","code","opts","assign","autoCreate","apiResponse","getMetadata","keys","length","body","res","setMetadata","json","request_","isAbsoluteUrl","indexOf","uriComponents","splice","x","trim","map","uriComponent","trimSlashesRegex","replace","join","childInterceptors","interceptors_","localInterceptors","slice","concat","shouldReturnStream","requestStream","promisifyAll"],"mappings":"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","sourcesContent":["\"use strict\";\n/*!\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*!\n * @module common/service-object\n */\nconst promisify_1 = require(\"@google-cloud/promisify\");\nconst arrify = require(\"arrify\");\nconst events_1 = require(\"events\");\nconst extend = require(\"extend\");\nconst util_1 = require(\"./util\");\n/**\n * ServiceObject is a base class, meant to be inherited from by a \"service\n * object,\" like a BigQuery dataset or Storage bucket.\n *\n * Most of the time, these objects share common functionality; they can be\n * created or deleted, and you can get or set their metadata.\n *\n * By inheriting from this class, a service object will be extended with these\n * shared behaviors. Note that any method can be overridden when the service\n * object requires specific behavior.\n */\n// tslint:disable-next-line no-any\nclass ServiceObject extends events_1.EventEmitter {\n    /*\n     * @constructor\n     * @alias module:common/service-object\n     *\n     * @private\n     *\n     * @param {object} config - Configuration object.\n     * @param {string} config.baseUrl - The base URL to make API requests to.\n     * @param {string} config.createMethod - The method which creates this object.\n     * @param {string=} config.id - The identifier of the object. For example, the\n     *     name of a Storage bucket or Pub/Sub topic.\n     * @param {object=} config.methods - A map of each method name that should be inherited.\n     * @param {object} config.methods[].reqOpts - Default request options for this\n     *     particular method. A common use case is when `setMetadata` requires a\n     *     `PUT` method to override the default `PATCH`.\n     * @param {object} config.parent - The parent service instance. For example, an\n     *     instance of Storage if the object is Bucket.\n     */\n    constructor(config) {\n        super();\n        this.metadata = {};\n        this.baseUrl = config.baseUrl;\n        this.parent = config.parent; // Parent class.\n        this.id = config.id; // Name or ID (e.g. dataset ID, bucket name, etc).\n        this.createMethod = config.createMethod;\n        this.methods = config.methods || {};\n        this.interceptors = [];\n        this.pollIntervalMs = config.pollIntervalMs;\n        this.Promise = this.parent ? this.parent.Promise : undefined;\n        if (config.methods) {\n            Object.getOwnPropertyNames(ServiceObject.prototype)\n                .filter(methodName => {\n                return (\n                // All ServiceObjects need `request`.\n                // clang-format off\n                !/^request/.test(methodName) &&\n                    // clang-format on\n                    // The ServiceObject didn't redefine the method.\n                    // tslint:disable-next-line no-any\n                    this[methodName] ===\n                        // tslint:disable-next-line no-any\n                        ServiceObject.prototype[methodName] &&\n                    // This method isn't wanted.\n                    !config.methods[methodName]);\n            })\n                .forEach(methodName => {\n                // tslint:disable-next-line no-any\n                this[methodName] = undefined;\n            });\n        }\n    }\n    create(optionsOrCallback, callback) {\n        const self = this;\n        const args = [this.id];\n        if (typeof optionsOrCallback === 'function') {\n            callback = optionsOrCallback;\n        }\n        if (typeof optionsOrCallback === 'object') {\n            args.push(optionsOrCallback);\n        }\n        // Wrap the callback to return *this* instance of the object, not the\n        // newly-created one.\n        // tslint: disable-next-line no-any\n        function onCreate(...args) {\n            const [err, instance] = args;\n            if (!err) {\n                self.metadata = instance.metadata;\n                args[1] = self; // replace the created `instance` with this one.\n            }\n            callback(...args);\n        }\n        args.push(onCreate);\n        this.createMethod.apply(null, args);\n    }\n    delete(optionsOrCallback, cb) {\n        const [options, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n        const methodConfig = (typeof this.methods.delete === 'object' && this.methods.delete) || {};\n        const reqOpts = extend(true, {\n            method: 'DELETE',\n            uri: '',\n        }, methodConfig.reqOpts, {\n            qs: options,\n        });\n        // The `request` method may have been overridden to hold any special\n        // behavior. Ensure we call the original `request` method.\n        ServiceObject.prototype.request.call(this, reqOpts, callback);\n    }\n    exists(optionsOrCallback, cb) {\n        const [options, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n        this.get(options, err => {\n            if (err) {\n                if (err.code === 404) {\n                    callback(null, false);\n                }\n                else {\n                    callback(err);\n                }\n                return;\n            }\n            callback(null, true);\n        });\n    }\n    get(optionsOrCallback, cb) {\n        const self = this;\n        const [opts, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n        const options = Object.assign({}, opts);\n        const autoCreate = options.autoCreate && typeof this.create === 'function';\n        delete options.autoCreate;\n        function onCreate(err, instance, apiResponse) {\n            if (err) {\n                if (err.code === 409) {\n                    self.get(options, callback);\n                    return;\n                }\n                callback(err, null, apiResponse);\n                return;\n            }\n            callback(null, instance, apiResponse);\n        }\n        this.getMetadata(options, (err, metadata) => {\n            if (err) {\n                if (err.code === 404 && autoCreate) {\n                    const args = [];\n                    if (Object.keys(options).length > 0) {\n                        args.push(options);\n                    }\n                    args.push(onCreate);\n                    self.create(...args);\n                    return;\n                }\n                callback(err, null, metadata);\n                return;\n            }\n            callback(null, self, metadata);\n        });\n    }\n    getMetadata(optionsOrCallback, cb) {\n        const [options, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n        const methodConfig = (typeof this.methods.getMetadata === 'object' &&\n            this.methods.getMetadata) ||\n            {};\n        const reqOpts = extend(true, {\n            uri: '',\n        }, methodConfig.reqOpts, {\n            qs: options,\n        });\n        // The `request` method may have been overridden to hold any special\n        // behavior. Ensure we call the original `request` method.\n        ServiceObject.prototype.request.call(this, reqOpts, (err, body, res) => {\n            this.metadata = body;\n            callback(err, this.metadata, res);\n        });\n    }\n    setMetadata(metadata, optionsOrCallback, cb) {\n        const [options, callback] = util_1.util.maybeOptionsOrCallback(optionsOrCallback, cb);\n        const methodConfig = (typeof this.methods.setMetadata === 'object' &&\n            this.methods.setMetadata) ||\n            {};\n        const reqOpts = extend(true, {}, {\n            method: 'PATCH',\n            uri: '',\n        }, methodConfig.reqOpts, {\n            json: metadata,\n            qs: options,\n        });\n        // The `request` method may have been overridden to hold any special\n        // behavior. Ensure we call the original `request` method.\n        ServiceObject.prototype.request.call(this, reqOpts, (err, body, res) => {\n            this.metadata = body;\n            callback(err, this.metadata, res);\n        });\n    }\n    request_(reqOpts, callback) {\n        reqOpts = extend(true, {}, reqOpts);\n        const isAbsoluteUrl = reqOpts.uri.indexOf('http') === 0;\n        const uriComponents = [this.baseUrl, this.id || '', reqOpts.uri];\n        if (isAbsoluteUrl) {\n            uriComponents.splice(0, uriComponents.indexOf(reqOpts.uri));\n        }\n        reqOpts.uri = uriComponents\n            .filter(x => x.trim()) // Limit to non-empty strings.\n            .map(uriComponent => {\n            const trimSlashesRegex = /^\\/*|\\/*$/g;\n            return uriComponent.replace(trimSlashesRegex, '');\n        })\n            .join('/');\n        const childInterceptors = arrify(reqOpts.interceptors_);\n        const localInterceptors = [].slice.call(this.interceptors);\n        reqOpts.interceptors_ = childInterceptors.concat(localInterceptors);\n        if (reqOpts.shouldReturnStream) {\n            return this.parent.requestStream(reqOpts);\n        }\n        this.parent.request(reqOpts, callback);\n    }\n    request(reqOpts, callback) {\n        this.request_(reqOpts, callback);\n    }\n    /**\n     * Make an authenticated API request.\n     *\n     * @param {object} reqOpts - Request options that are passed to `request`.\n     * @param {string} reqOpts.uri - A URI relative to the baseUrl.\n     */\n    requestStream(reqOpts) {\n        const opts = extend(true, reqOpts, { shouldReturnStream: true });\n        return this.request_(opts);\n    }\n}\nexports.ServiceObject = ServiceObject;\npromisify_1.promisifyAll(ServiceObject);\n//# sourceMappingURL=service-object.js.map"]},"metadata":{},"sourceType":"script"}