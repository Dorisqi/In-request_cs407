{"ast":null,"code":"/*! firebase-admin v8.9.2 */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar url_1 = require(\"url\");\n\nvar path = require(\"path\");\n\nvar error_1 = require(\"../utils/error\");\n\nvar validator = require(\"../utils/validator\");\n\nvar api_request_1 = require(\"../utils/api-request\");\n/**\n * Internals of a Database instance.\n */\n\n\nvar DatabaseInternals =\n/** @class */\nfunction () {\n  function DatabaseInternals() {\n    this.databases = {};\n  }\n  /**\n   * Deletes the service and its associated resources.\n   *\n   * @return {Promise<()>} An empty Promise that will be fulfilled when the service is deleted.\n   */\n\n\n  DatabaseInternals.prototype.delete = function () {\n    for (var _i = 0, _a = Object.keys(this.databases); _i < _a.length; _i++) {\n      var dbUrl = _a[_i];\n      var db = this.databases[dbUrl];\n      db.INTERNAL.delete();\n    }\n\n    return Promise.resolve(undefined);\n  };\n\n  return DatabaseInternals;\n}();\n\nvar DatabaseService =\n/** @class */\nfunction () {\n  function DatabaseService(app) {\n    this.INTERNAL = new DatabaseInternals();\n\n    if (!validator.isNonNullObject(app) || !('options' in app)) {\n      throw new error_1.FirebaseDatabaseError({\n        code: 'invalid-argument',\n        message: 'First argument passed to admin.database() must be a valid Firebase app instance.'\n      });\n    }\n\n    this.appInternal = app;\n  }\n\n  Object.defineProperty(DatabaseService.prototype, \"app\", {\n    /**\n     * Returns the app associated with this DatabaseService instance.\n     *\n     * @return {FirebaseApp} The app associated with this DatabaseService instance.\n     */\n    get: function () {\n      return this.appInternal;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  DatabaseService.prototype.getDatabase = function (url) {\n    var dbUrl = this.ensureUrl(url);\n\n    if (!validator.isNonEmptyString(dbUrl)) {\n      throw new error_1.FirebaseDatabaseError({\n        code: 'invalid-argument',\n        message: 'Database URL must be a valid, non-empty URL string.'\n      });\n    }\n\n    var db = this.INTERNAL.databases[dbUrl];\n\n    if (typeof db === 'undefined') {\n      var rtdb = require('@firebase/database');\n\n      var version = require('../../package.json').version;\n\n      db = rtdb.initStandalone(this.appInternal, dbUrl, version).instance;\n      var rulesClient_1 = new DatabaseRulesClient(this.app, dbUrl);\n\n      db.getRules = function () {\n        return rulesClient_1.getRules();\n      };\n\n      db.getRulesJSON = function () {\n        return rulesClient_1.getRulesJSON();\n      };\n\n      db.setRules = function (source) {\n        return rulesClient_1.setRules(source);\n      };\n\n      this.INTERNAL.databases[dbUrl] = db;\n    }\n\n    return db;\n  };\n\n  DatabaseService.prototype.ensureUrl = function (url) {\n    if (typeof url !== 'undefined') {\n      return url;\n    } else if (typeof this.appInternal.options.databaseURL !== 'undefined') {\n      return this.appInternal.options.databaseURL;\n    }\n\n    throw new error_1.FirebaseDatabaseError({\n      code: 'invalid-argument',\n      message: 'Can\\'t determine Firebase Database URL.'\n    });\n  };\n\n  return DatabaseService;\n}();\n\nexports.DatabaseService = DatabaseService;\nvar RULES_URL_PATH = '.settings/rules.json';\n/**\n * A helper client for managing RTDB security rules.\n */\n\nvar DatabaseRulesClient =\n/** @class */\nfunction () {\n  function DatabaseRulesClient(app, dbUrl) {\n    var parsedUrl = new url_1.URL(dbUrl);\n    parsedUrl.pathname = path.join(parsedUrl.pathname, RULES_URL_PATH);\n    this.dbUrl = parsedUrl.toString();\n    this.httpClient = new api_request_1.AuthorizedHttpClient(app);\n  }\n  /**\n   * Gets the currently applied security rules as a string. The return value consists of\n   * the rules source including comments.\n   *\n   * @return {Promise<string>} A promise fulfilled with the rules as a raw string.\n   */\n\n\n  DatabaseRulesClient.prototype.getRules = function () {\n    var _this = this;\n\n    var req = {\n      method: 'GET',\n      url: this.dbUrl\n    };\n    return this.httpClient.send(req).then(function (resp) {\n      if (!resp.text) {\n        throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INTERNAL_ERROR, 'HTTP response missing data.');\n      }\n\n      return resp.text;\n    }).catch(function (err) {\n      throw _this.handleError(err);\n    });\n  };\n  /**\n   * Gets the currently applied security rules as a parsed JSON object. Any comments in\n   * the original source are stripped away.\n   *\n   * @return {Promise<object>} A promise fulfilled with the parsed rules source.\n   */\n\n\n  DatabaseRulesClient.prototype.getRulesJSON = function () {\n    var _this = this;\n\n    var req = {\n      method: 'GET',\n      url: this.dbUrl,\n      data: {\n        format: 'strict'\n      }\n    };\n    return this.httpClient.send(req).then(function (resp) {\n      return resp.data;\n    }).catch(function (err) {\n      throw _this.handleError(err);\n    });\n  };\n  /**\n   * Sets the specified rules on the Firebase Database instance. If the rules source is\n   * specified as a string or a Buffer, it may include comments.\n   *\n   * @param {string|Buffer|object} source Source of the rules to apply. Must not be `null`\n   *  or empty.\n   * @return {Promise<void>} Resolves when the rules are set on the Database.\n   */\n\n\n  DatabaseRulesClient.prototype.setRules = function (source) {\n    var _this = this;\n\n    if (!validator.isNonEmptyString(source) && !validator.isBuffer(source) && !validator.isNonNullObject(source)) {\n      var error = new error_1.FirebaseDatabaseError({\n        code: 'invalid-argument',\n        message: 'Source must be a non-empty string, Buffer or an object.'\n      });\n      return Promise.reject(error);\n    }\n\n    var req = {\n      method: 'PUT',\n      url: this.dbUrl,\n      data: source,\n      headers: {\n        'content-type': 'application/json; charset=utf-8'\n      }\n    };\n    return this.httpClient.send(req).then(function () {\n      return;\n    }).catch(function (err) {\n      throw _this.handleError(err);\n    });\n  };\n\n  DatabaseRulesClient.prototype.handleError = function (err) {\n    if (err instanceof api_request_1.HttpError) {\n      return new error_1.FirebaseDatabaseError({\n        code: error_1.AppErrorCodes.INTERNAL_ERROR,\n        message: this.getErrorMessage(err)\n      });\n    }\n\n    return err;\n  };\n\n  DatabaseRulesClient.prototype.getErrorMessage = function (err) {\n    var intro = 'Error while accessing security rules';\n\n    try {\n      var body = err.response.data;\n\n      if (body && body.error) {\n        return intro + \": \" + body.error.trim();\n      }\n    } catch (_a) {// Ignore parsing errors\n    }\n\n    return intro + \": \" + err.response.text;\n  };\n\n  return DatabaseRulesClient;\n}();","map":{"version":3,"sources":["/Users/qier/Documents/cs407/In-request_cs407/dev/Front-end/in-request/node_modules/firebase-admin/lib/database/database.js"],"names":["Object","defineProperty","exports","value","url_1","require","path","error_1","validator","api_request_1","DatabaseInternals","databases","prototype","delete","_i","_a","keys","length","dbUrl","db","INTERNAL","Promise","resolve","undefined","DatabaseService","app","isNonNullObject","FirebaseDatabaseError","code","message","appInternal","get","enumerable","configurable","getDatabase","url","ensureUrl","isNonEmptyString","rtdb","version","initStandalone","instance","rulesClient_1","DatabaseRulesClient","getRules","getRulesJSON","setRules","source","options","databaseURL","RULES_URL_PATH","parsedUrl","URL","pathname","join","toString","httpClient","AuthorizedHttpClient","_this","req","method","send","then","resp","text","FirebaseAppError","AppErrorCodes","INTERNAL_ERROR","catch","err","handleError","data","format","isBuffer","error","reject","headers","HttpError","getErrorMessage","intro","body","response","trim"],"mappings":"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","sourcesContent":["/*! firebase-admin v8.9.2 */\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar url_1 = require(\"url\");\nvar path = require(\"path\");\nvar error_1 = require(\"../utils/error\");\nvar validator = require(\"../utils/validator\");\nvar api_request_1 = require(\"../utils/api-request\");\n/**\n * Internals of a Database instance.\n */\nvar DatabaseInternals = /** @class */ (function () {\n    function DatabaseInternals() {\n        this.databases = {};\n    }\n    /**\n     * Deletes the service and its associated resources.\n     *\n     * @return {Promise<()>} An empty Promise that will be fulfilled when the service is deleted.\n     */\n    DatabaseInternals.prototype.delete = function () {\n        for (var _i = 0, _a = Object.keys(this.databases); _i < _a.length; _i++) {\n            var dbUrl = _a[_i];\n            var db = this.databases[dbUrl];\n            db.INTERNAL.delete();\n        }\n        return Promise.resolve(undefined);\n    };\n    return DatabaseInternals;\n}());\nvar DatabaseService = /** @class */ (function () {\n    function DatabaseService(app) {\n        this.INTERNAL = new DatabaseInternals();\n        if (!validator.isNonNullObject(app) || !('options' in app)) {\n            throw new error_1.FirebaseDatabaseError({\n                code: 'invalid-argument',\n                message: 'First argument passed to admin.database() must be a valid Firebase app instance.',\n            });\n        }\n        this.appInternal = app;\n    }\n    Object.defineProperty(DatabaseService.prototype, \"app\", {\n        /**\n         * Returns the app associated with this DatabaseService instance.\n         *\n         * @return {FirebaseApp} The app associated with this DatabaseService instance.\n         */\n        get: function () {\n            return this.appInternal;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DatabaseService.prototype.getDatabase = function (url) {\n        var dbUrl = this.ensureUrl(url);\n        if (!validator.isNonEmptyString(dbUrl)) {\n            throw new error_1.FirebaseDatabaseError({\n                code: 'invalid-argument',\n                message: 'Database URL must be a valid, non-empty URL string.',\n            });\n        }\n        var db = this.INTERNAL.databases[dbUrl];\n        if (typeof db === 'undefined') {\n            var rtdb = require('@firebase/database');\n            var version = require('../../package.json').version;\n            db = rtdb.initStandalone(this.appInternal, dbUrl, version).instance;\n            var rulesClient_1 = new DatabaseRulesClient(this.app, dbUrl);\n            db.getRules = function () {\n                return rulesClient_1.getRules();\n            };\n            db.getRulesJSON = function () {\n                return rulesClient_1.getRulesJSON();\n            };\n            db.setRules = function (source) {\n                return rulesClient_1.setRules(source);\n            };\n            this.INTERNAL.databases[dbUrl] = db;\n        }\n        return db;\n    };\n    DatabaseService.prototype.ensureUrl = function (url) {\n        if (typeof url !== 'undefined') {\n            return url;\n        }\n        else if (typeof this.appInternal.options.databaseURL !== 'undefined') {\n            return this.appInternal.options.databaseURL;\n        }\n        throw new error_1.FirebaseDatabaseError({\n            code: 'invalid-argument',\n            message: 'Can\\'t determine Firebase Database URL.',\n        });\n    };\n    return DatabaseService;\n}());\nexports.DatabaseService = DatabaseService;\nvar RULES_URL_PATH = '.settings/rules.json';\n/**\n * A helper client for managing RTDB security rules.\n */\nvar DatabaseRulesClient = /** @class */ (function () {\n    function DatabaseRulesClient(app, dbUrl) {\n        var parsedUrl = new url_1.URL(dbUrl);\n        parsedUrl.pathname = path.join(parsedUrl.pathname, RULES_URL_PATH);\n        this.dbUrl = parsedUrl.toString();\n        this.httpClient = new api_request_1.AuthorizedHttpClient(app);\n    }\n    /**\n     * Gets the currently applied security rules as a string. The return value consists of\n     * the rules source including comments.\n     *\n     * @return {Promise<string>} A promise fulfilled with the rules as a raw string.\n     */\n    DatabaseRulesClient.prototype.getRules = function () {\n        var _this = this;\n        var req = {\n            method: 'GET',\n            url: this.dbUrl,\n        };\n        return this.httpClient.send(req)\n            .then(function (resp) {\n            if (!resp.text) {\n                throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INTERNAL_ERROR, 'HTTP response missing data.');\n            }\n            return resp.text;\n        })\n            .catch(function (err) {\n            throw _this.handleError(err);\n        });\n    };\n    /**\n     * Gets the currently applied security rules as a parsed JSON object. Any comments in\n     * the original source are stripped away.\n     *\n     * @return {Promise<object>} A promise fulfilled with the parsed rules source.\n     */\n    DatabaseRulesClient.prototype.getRulesJSON = function () {\n        var _this = this;\n        var req = {\n            method: 'GET',\n            url: this.dbUrl,\n            data: { format: 'strict' },\n        };\n        return this.httpClient.send(req)\n            .then(function (resp) {\n            return resp.data;\n        })\n            .catch(function (err) {\n            throw _this.handleError(err);\n        });\n    };\n    /**\n     * Sets the specified rules on the Firebase Database instance. If the rules source is\n     * specified as a string or a Buffer, it may include comments.\n     *\n     * @param {string|Buffer|object} source Source of the rules to apply. Must not be `null`\n     *  or empty.\n     * @return {Promise<void>} Resolves when the rules are set on the Database.\n     */\n    DatabaseRulesClient.prototype.setRules = function (source) {\n        var _this = this;\n        if (!validator.isNonEmptyString(source) &&\n            !validator.isBuffer(source) &&\n            !validator.isNonNullObject(source)) {\n            var error = new error_1.FirebaseDatabaseError({\n                code: 'invalid-argument',\n                message: 'Source must be a non-empty string, Buffer or an object.',\n            });\n            return Promise.reject(error);\n        }\n        var req = {\n            method: 'PUT',\n            url: this.dbUrl,\n            data: source,\n            headers: {\n                'content-type': 'application/json; charset=utf-8',\n            },\n        };\n        return this.httpClient.send(req)\n            .then(function () {\n            return;\n        })\n            .catch(function (err) {\n            throw _this.handleError(err);\n        });\n    };\n    DatabaseRulesClient.prototype.handleError = function (err) {\n        if (err instanceof api_request_1.HttpError) {\n            return new error_1.FirebaseDatabaseError({\n                code: error_1.AppErrorCodes.INTERNAL_ERROR,\n                message: this.getErrorMessage(err),\n            });\n        }\n        return err;\n    };\n    DatabaseRulesClient.prototype.getErrorMessage = function (err) {\n        var intro = 'Error while accessing security rules';\n        try {\n            var body = err.response.data;\n            if (body && body.error) {\n                return intro + \": \" + body.error.trim();\n            }\n        }\n        catch (_a) {\n            // Ignore parsing errors\n        }\n        return intro + \": \" + err.response.text;\n    };\n    return DatabaseRulesClient;\n}());\n"]},"metadata":{},"sourceType":"script"}